<!DOCTYPE html>
<html lang="en">
<head>
  <title>Execution Methodology Builder</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
  <style>
    body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
    body {font-size:16px;}
    .w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
    .w3-half img:hover{opacity:1}
    .top-right-button { position: absolute; top: 20px; right: 30px; }
    .modal-margin { margin-bottom: 30px; }
    .w3-modal { display: none; }
  </style>
  <!-- Supabase JS (using ESM import) -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
  const supabaseClient = createClient(
    'https://vgiyutkufqgfgvixkhqz.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZnaXl1dGt1ZnFnZmd2aXhraHF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NDM2NjksImV4cCI6MjA2NDAxOTY2OX0.siQnaghNgiZpSj5p5LriQHN1ZkUs4DY7bdPSzD-mCrg'
  );
  console.log('Supabase Client Initialized:', supabaseClient);
  // Make available globally
  window.supabaseClient = supabaseClient;
  // Test Supabase connection by querying a known table
  (async () => {
    try {
      const { error } = await window.supabaseClient.from('execution_methodologies').select('id').limit(1);
      if (error) throw error;
    } catch (err) {
      console.error('Supabase connection test failed', err);
      alert('Supabase connection failed: please verify your Supabase URL and anon key.');
    }
  })();
</script>

<script>
  // Sign Up Handler with supabaseClient
  document.getElementById('signupForm').onsubmit = async (e) => {
    e.preventDefault();
    const values = Object.fromEntries(new FormData(e.target));
    console.log('Signing up with:', values);
    const { data, error } = await window.supabaseClient.auth.signUp(
      { email: values.email, password: values.password },
      { data: { full_name: values.full_name, company: values.company, position: values.position, package_selected: values.package_selected } }
    );
    console.log('Signup response:', { data, error });
    if (error) alert(error.message);
    else { alert('Registration successful! Please check your email to confirm.'); closeSignUp(); }
  };

  // Sign In Handler with supabaseClient
  document.getElementById('signinForm').onsubmit = async (e) => {
    e.preventDefault();
    const { email, password } = Object.fromEntries(new FormData(e.target));
    console.log('Signing in:', { email });
    const { data, error } = await window.supabaseClient.auth.signInWithPassword({ email, password });
    console.log('Signin response:', { data, error });
    if (error) alert(error.message);
    else { alert('Login successful!'); closeSignIn(); }
  };
</script>
    // Define modal controls before usage
    function openSignUp() { document.getElementById('id01').style.display = 'block'; }
    function closeSignUp() { document.getElementById('id01').style.display = 'none'; }
    function openSignIn() { document.getElementById('id02').style.display = 'block'; }
    function closeSignIn() { document.getElementById('id02').style.display = 'none'; }
    function w3_open() { document.getElementById('mySidebar').style.display = 'block'; document.getElementById('myOverlay').style.display = 'block'; }
    function w3_close() { document.getElementById('mySidebar').style.display = 'none'; document.getElementById('myOverlay').style.display = 'none'; }
  </script>

  <script>
    // Initialize Supabase client and debug
    const supabaseClient = supabase.createClient(
      'https://6f017aef7a25c3d1b990e386bbe5fa55f03c058af2c8e4357c6f367d2a71ad13.supabase.co',
      'bd9b30706e131473f62897c9de8566f8eccbfda30df57ef07693cc267d32be5a'
    );
    console.log('Supabase Client Initialized:', supabaseClient);

    // Sign Up Handler with debug
    document.getElementById('signupForm').onsubmit = async (e) => {
      e.preventDefault();
      const values = Object.fromEntries(new FormData(e.target));
      console.log('Signing up with:', values);
      const { data, error } = await supabaseClient.auth.signUp(
        { email: values.email, password: values.password },
        { data: { full_name: values.full_name, company: values.company, position: values.position, package_selected: values.package_selected } }
      );
      console.log('Signup response:', { data, error });
      if (error) alert(error.message);
      else { alert('Registration successful! Please check your email to confirm.'); closeSignUp(); }
    };

    // Sign In Handler with debug
    document.getElementById('signinForm').onsubmit = async (e) => {
      e.preventDefault();
      const { email, password } = Object.fromEntries(new FormData(e.target));
      console.log('Signing in:', { email });
      const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
      console.log('Signin response:', { data, error });
      if (error) alert(error.message);
      else { alert('Login successful!'); closeSignIn(); }
    };
  </script>

</body>
</html>
